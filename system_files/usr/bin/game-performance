#!/usr/bin/env bash
# Helper script to enable the performance profile with proton or others
# For Bazzite-based images using tuned profiles

# Check if tuned-adm is available
if ! command -v tuned-adm &>/dev/null; then
    echo "Error: tuned-adm not found" >&2
    exit 1
fi

# Don't fail if the profile doesn't exist, just run the command
if ! tuned-adm list | grep -q 'throughput-performance-bazzite'; then
    exec "$@"
fi

# Set performance profile, as long as the game is launched
if [ -n "$GAME_PERFORMANCE_SCREENSAVER_ON" ]; then
    tuned-adm profile throughput-performance-bazzite
    exec "$@"
else
    tuned-adm profile throughput-performance-bazzite
    exec systemd-inhibit --why "game-performance is running" -- "$@"
fi